# ============================================================
# BIO-DASHBOARD + WATER TRACKER â€” HA Configuration Additions
# ============================================================
#
# FÃ¼ge diese BlÃ¶cke in deine configuration.yaml ein.
# Danach HA neu starten (Developer Tools â†’ YAML â†’ Restart).
#
# WICHTIG: Du hast bereits Abschnitte wie input_number:, rest_command:
# und template: in deiner config.yaml. FÃ¼ge die neuen EintrÃ¤ge
# INNERHALB der bestehenden Abschnitte ein (nicht doppelt anlegen!).
# ============================================================


# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 1. UNTER deinem bestehenden  input_number:  einfÃ¼gen
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# (Du hast schon input_number: mit alarm_hours / alarm_minutes etc.)
# FÃ¼ge darunter hinzu:

  user_weight_kg:
    name: KÃ¶rpergewicht
    min: 50
    max: 200
    step: 0.1
    unit_of_measurement: kg
    icon: mdi:scale-bathroom
    initial: 96.0


# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 2. NEUER Abschnitt  input_button:
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# (Falls du noch keinen input_button: Abschnitt hast,
#  fÃ¼ge den ganzen Block ein.)

input_button:
  elvanse_taken:
    name: Elvanse genommen
    icon: mdi:pill

  mate_consumed:
    name: Mate getrunken
    icon: mdi:cup


# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 3. UNTER deinem bestehenden  rest_command:  einfÃ¼gen
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# (Du hast schon rest_command: mit print_label etc.)
# FÃ¼ge darunter hinzu:

  bio_log_elvanse:
    url: "https://bioapi.thegrandprinterofmemesandunfinitetodosservanttonox.tech/api/webhook/ha/intake"
    method: POST
    headers:
      x-api-key: "bio_leandro_2026_secret"
    content_type: "application/json"
    payload: '{"substance": "elvanse", "dose_mg": 40}'
    timeout: 10

  bio_log_mate:
    url: "https://bioapi.thegrandprinterofmemesandunfinitetodosservanttonox.tech/api/webhook/ha/intake"
    method: POST
    headers:
      x-api-key: "bio_leandro_2026_secret"
    content_type: "application/json"
    payload: '{"substance": "mate", "dose_mg": 80}'
    timeout: 10

  bio_log_lamotrigin:
    url: "https://bioapi.thegrandprinterofmemesandunfinitetodosservanttonox.tech/api/webhook/ha/intake"
    method: POST
    headers:
      x-api-key: "bio_leandro_2026_secret"
    content_type: "application/json"
    payload: '{"substance": "lamotrigin"}'
    timeout: 10


# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 4. UNTER deinem bestehenden  template:  einfÃ¼gen
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# (Du hast schon template: mit wake_time_today etc.)
# FÃ¼ge einen weiteren  - sensor:  Block hinzu:

  - sensor:
      - name: "Water Intake Percentage"
        unique_id: water_intake_pct
        unit_of_measurement: "%"
        icon: mdi:cup-water
        state: >
          {% set intake = states('sensor.water_tracker_daily') | float(0) %}
          {% set goal = state_attr('sensor.water_tracker_daily', 'daily_goal') | float(3200) %}
          {{ ((intake / goal) * 100) | round(0) }}

      - name: "Water Intake Remaining"
        unique_id: water_intake_remaining
        unit_of_measurement: "ml"
        icon: mdi:cup-outline
        state: >
          {% set intake = states('sensor.water_tracker_daily') | float(0) %}
          {% set goal = state_attr('sensor.water_tracker_daily', 'daily_goal') | float(3200) %}
          {{ [goal - intake, 0] | max | round(0) }}


# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 5. AUTOMATIONS â€” in automations.yaml einfÃ¼gen
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# (HA UI â†’ Settings â†’ Automations â†’ â‹® â†’ Edit in YAML, oder
#  direkt in automations.yaml einfÃ¼gen.)

# - id: bio_elvanse_push
#   alias: Bio - Elvanse geloggt
#   trigger:
#   - platform: state
#     entity_id: input_button.elvanse_taken
#   action:
#   - service: rest_command.bio_log_elvanse
#     data: {}
#   mode: single
#
# - id: bio_mate_push
#   alias: Bio - Mate geloggt
#   trigger:
#   - platform: state
#     entity_id: input_button.mate_consumed
#   action:
#   - service: rest_command.bio_log_mate
#     data: {}
#   mode: single
#
# - id: water_tracker_goal_reached
#   alias: Water Tracker - Tagesziel erreicht
#   trigger:
#   - platform: template
#     value_template: >
#       {{ states('sensor.water_tracker_daily') | float(0)
#          >= state_attr('sensor.water_tracker_daily', 'daily_goal') | float(3200) }}
#   action:
#   - service: notify.notify
#     data:
#       title: "ðŸ’§ Tagesziel erreicht!"
#       message: >
#         Du hast {{ states('sensor.water_tracker_daily') }} ml getrunken.
#   mode: single


# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 6. WATCH HR + SLEEP COMPANION â€” Template-Sensoren
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Die Watch pusht Herzfrequenz und Schlaf-Daten via POST /api/health
# an den bio-dashboard-Server. Dieser speichert sie in health_snapshots.
#
# Um die Daten auch in HA sichtbar zu machen, kannst du REST-Sensoren
# anlegen, die den Server pollen. Alternativ sind sie bereits via
# Google Fit â†’ HealthSync â†’ HA verfÃ¼gbar (sensor.pixel_9_pro_xl_heart_rate_2 etc.).
#
# Falls du ZUSÃ„TZLICH die Watch-Daten direkt in HA sehen willst:

# UNTER deinem bestehenden  template:  einfÃ¼gen:

#   - sensor:
#       - name: "Watch Heart Rate"
#         unique_id: watch_heart_rate
#         unit_of_measurement: "bpm"
#         icon: mdi:heart-pulse
#         device_class: None
#         state_class: measurement
#         state: >
#           {{ state_attr('sensor.bio_dashboard_health', 'heart_rate') | float(0) }}
#
#       - name: "Watch Resting HR"
#         unique_id: watch_resting_hr
#         unit_of_measurement: "bpm"
#         icon: mdi:heart
#         state_class: measurement
#         state: >
#           {{ state_attr('sensor.bio_dashboard_health', 'resting_hr') | float(0) }}
#
#       - name: "Watch Sleep Duration"
#         unique_id: watch_sleep_duration
#         unit_of_measurement: "h"
#         icon: mdi:sleep
#         state_class: measurement
#         state: >
#           {{ state_attr('sensor.bio_dashboard_health', 'sleep_duration') | float(0) }}

# ALTERNATIV: REST-Sensor der den bio-dashboard-Server direkt pollt:

#  rest:
#    - resource: "https://bioapi.thegrandprinterofmemesandunfinitetodosservanttonox.tech/api/health/latest"
#      headers:
#        x-api-key: "bio_leandro_2026_secret"
#      scan_interval: 900
#      sensor:
#        - name: "Bio Dashboard Latest HR"
#          unique_id: bio_dashboard_latest_hr
#          value_template: "{{ value_json.heart_rate | default(0) }}"
#          unit_of_measurement: "bpm"
#          icon: mdi:heart-pulse
#
#        - name: "Bio Dashboard Latest Resting HR"
#          unique_id: bio_dashboard_latest_rhr
#          value_template: "{{ value_json.resting_hr | default(0) }}"
#          unit_of_measurement: "bpm"
#          icon: mdi:heart
#
#        - name: "Bio Dashboard Sleep Duration"
#          unique_id: bio_dashboard_sleep_duration
#          value_template: "{{ value_json.sleep_duration | default(0) }}"
#          unit_of_measurement: "h"
#          icon: mdi:sleep

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# HINWEIS: Du brauchst diese HA-Sensoren NICHT fÃ¼r die Grundfunktion.
# Die Watch pusht direkt an den Server, der Server speichert alles.
# Die HA-Sensoren sind nur nÃ¼tzlich wenn du die Daten in HA-Dashboards
# oder Automationen verwenden willst (z.B. Benachrichtigung bei hohem Puls).
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
