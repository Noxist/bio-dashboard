# ============================================
# HOME ASSISTANT CONFIG SNIPPETS
# Bio-Dashboard Integration
# ============================================
#
# Fuege diese Abschnitte in deine HA configuration.yaml ein.
# Danach HA neu starten.
#
# 1. Ersetze BIO_API_URL mit der echten URL deines Bio-Dashboard Servers.
# 2. Ersetze BIO_API_KEY mit dem Wert aus services/.env (BIO_API_KEY).
# 3. Erstelle einen HA Long-Lived Access Token:
#    HA UI -> Profil -> Long-Lived Access Tokens -> Token erstellen
#    Trage den Token in services/.env unter HA_TOKEN ein.

# ============================================
# 1. INPUT BUTTONS (in configuration.yaml)
# ============================================

# input_button:
#   elvanse_taken:
#     name: Elvanse genommen
#     icon: mdi:pill
#
#   mate_consumed:
#     name: Mate getrunken
#     icon: mdi:cup

# ============================================
# 2. REST COMMANDS (in configuration.yaml)
# ============================================

# rest_command:
#   bio_log_elvanse:
#     url: "https://bioapi.thegrandprinterofmemesandunfinitetodosservanttonox.tech/api/webhook/ha/intake"
#     method: POST
#     headers:
#       x-api-key: "bio_leandro_2026_secret"
#     content_type: "application/json"
#     payload: '{"substance": "elvanse", "dose_mg": 40}'
#     timeout: 10
#
#   bio_log_mate:
#     url: "https://bioapi.thegrandprinterofmemesandunfinitetodosservanttonox.tech/api/webhook/ha/intake"
#     method: POST
#     headers:
#       x-api-key: "bio_leandro_2026_secret"
#     content_type: "application/json"
#     payload: '{"substance": "mate", "dose_mg": 80}'
#     timeout: 10
#
#   bio_log_lamotrigin:
#     url: "https://bioapi.thegrandprinterofmemesandunfinitetodosservanttonox.tech/api/webhook/ha/intake"
#     method: POST
#     headers:
#       x-api-key: "bio_leandro_2026_secret"
#     content_type: "application/json"
#     payload: '{"substance": "lamotrigin"}'
#     timeout: 10

# ============================================
# 3. AUTOMATIONS (in automations.yaml)
# ============================================

# - id: bio_elvanse_push
#   alias: Bio -- Elvanse geloggt
#   triggers:
#   - trigger: state
#     entity_id: input_button.elvanse_taken
#   actions:
#   - action: rest_command.bio_log_elvanse
#     data: {}
#   mode: single
#
# - id: bio_mate_push
#   alias: Bio -- Mate geloggt
#   triggers:
#   - trigger: state
#     entity_id: input_button.mate_consumed
#   actions:
#   - action: rest_command.bio_log_mate
#     data: {}
#   mode: single
#
# - id: bio_lamotrigin_push
#   alias: Bio -- Lamotrigin geloggt
#   description: Wird getriggert wenn Lamotrigin-Todo als completed markiert wird
#   triggers:
#   - trigger: state
#     entity_id: todo.medikamente
#   conditions:
#   - condition: template
#     value_template: "{{ 'Lamotrigin' in trigger.to_state.attributes.get('items', '') }}"
#   actions:
#   - action: rest_command.bio_log_lamotrigin
#     data: {}
#   mode: single

# ============================================
# 4. NFC TAG ACTIONS (optional)
# ============================================
# Du kannst NFC-Tags auf deinem Nachttisch platzieren:
# - Tag 1: Elvanse genommen -> triggert input_button.elvanse_taken
# - Tag 2: Mate getrunken -> triggert input_button.mate_consumed
#
# - id: nfc_elvanse
#   alias: NFC -- Elvanse
#   triggers:
#   - trigger: tag
#     tag_id: DEIN_ELVANSE_TAG_ID
#   actions:
#   - action: input_button.press
#     target:
#       entity_id: input_button.elvanse_taken
#   - action: rest_command.bio_log_elvanse
#     data: {}
#   mode: single

# ============================================
# 5. WEIGHT TRACKING (in configuration.yaml)
# ============================================
# Manueller Gewichts-Sensor â€” trage dein Gewicht hier ein wenn es sich aendert.
# Bio-Dashboard liest diesen Wert beim naechsten Poll und aktualisiert
# das dynamische Wasser-Tagesziel automatisch.
#
# input_number:
#   user_weight_kg:
#     name: KÃ¶rpergewicht
#     min: 50
#     max: 200
#     step: 0.1
#     unit_of_measurement: kg
#     icon: mdi:scale-bathroom
#     initial: 96.0

# ============================================
# 6. WATER TRACKER INTEGRATION
# ============================================
# Die Huawei Watch pushed sensor.water_tracker_daily direkt via REST API.
# Diese Template-Sensoren berechnen Fortschritt und Rest.
#
# template:
#   - sensor:
#       - name: "Water Intake Percentage"
#         unique_id: water_intake_pct
#         unit_of_measurement: "%"
#         icon: mdi:cup-water
#         state: >
#           {% set intake = states('sensor.water_tracker_daily') | float(0) %}
#           {% set goal = state_attr('sensor.water_tracker_daily', 'daily_goal') | float(3200) %}
#           {{ ((intake / goal) * 100) | round(0) }}
#
#       - name: "Water Intake Remaining"
#         unique_id: water_intake_remaining
#         unit_of_measurement: "ml"
#         icon: mdi:cup-outline
#         state: >
#           {% set intake = states('sensor.water_tracker_daily') | float(0) %}
#           {% set goal = state_attr('sensor.water_tracker_daily', 'daily_goal') | float(3200) %}
#           {{ [goal - intake, 0] | max | round(0) }}
#
# automation:
#   # Feier wenn Tagesziel erreicht
#   - id: water_tracker_goal_reached
#     alias: "Water Tracker - Goal Reached"
#     trigger:
#       - platform: template
#         value_template: >
#           {{ states('sensor.water_tracker_daily') | float(0)
#              >= state_attr('sensor.water_tracker_daily', 'daily_goal') | float(3200) }}
#     action:
#       - service: notify.notify
#         data:
#           title: "Tagesziel erreicht!"
#           message: >
#             Super! Du hast {{ states('sensor.water_tracker_daily') }} ml getrunken.
